# Product Requirements Document: PKK Data Extractor

## 1. Введение

### 1.1. Цель проекта
Разработать программное обеспечение (ПО) для автоматизированного получения информации о земельных участках (ЗУ) с публичного веб-ресурса "Портал пространственных данных Национальная система пространственных данных Публичная кадастровая карта" (далее - PKK).

### 1.2. Краткий обзор
ПО предназначено для упрощения и автоматизации процесса сбора кадастровых данных по заданным зонам интереса, их сохранения в различных форматах и генерации отчетов. Предусматривается развитие от консольного приложения к версии с графическим интерфейсом и интерактивной картой.

## 2. Целевая аудитория
Пользователи, нуждающиеся в актуальной кадастровой информации для анализа, планирования, исследований или иной профессиональной деятельности, связанной с земельными участками.

## 3. Функциональные требования

### 3.1. Режим работы
-   **FR-1:** Начальные версии ПО должны функционировать в режиме командной строки (CLI).
-   **FR-2:** Должна быть предусмотрена и спроектирована возможность расширения функциональности до полноценного графического пользовательского интерфейса (GUI) в будущих версиях.

### 3.2. Входные данные (Зона интереса)
-   **FR-3:** ПО должно принимать на вход имя файла (или нескольких файлов) с описанием зоны интереса через параметры командной строки.
-   **FR-4:** На первом этапе обязательна поддержка формата KML (Keyhole Markup Language) версии 2.2. Поддержка других версий KML желательна.
-   **FR-5:** Входные KML файлы должны содержать описания объектов интереса (линии, полигоны и т.д.), определяющих границы зоны для поиска ЗУ.
-   **FR-6:** В перспективе, ПО должно поддерживать другие форматы входных файлов. Целесообразно рассмотреть возможность автоматического определения формата и обработки всех поддерживаемых форматов через единый ключ командной строки.

### 3.3. Получение данных с PKK
-   **FR-7:** ПО должно автоматически подключаться к целевому веб-ресурсу PKK по адресу: `https://nspd.gov.ru/map?thematic=PKK&active_layers=36473%2C849453%2C849407%2C37298%2C37299%2C37294%2C36048`.
-   **FR-8:** ПО должно находить и скачивать информацию о ЗУ, геометрия которых пересекается с указанной зоной интереса.
-   **FR-9:** Обязательные данные для скачивания по каждому ЗУ:
    -   Геометрия (координаты границ).
    -   Кадастровый номер.
    -   Категория земель.
    -   Вид разрешенного использования.
-   **FR-10:** Желательно обеспечить возможность скачивания полного пакета доступной атрибутивной информации по каждому ЗУ.

### 3.4. Сохранение данных
-   **FR-11:** ПО должно сохранять полученную информацию о ЗУ локально.
-   **FR-12:** Поддерживаемые форматы для сохранения данных (выбираются ключами командной строки):
    -   GeoJSON (формат по умолчанию).
    -   CSV.
    -   SQLite.
-   **FR-13:** Допускается одновременное использование нескольких ключей для сохранения в различных форматах.

### 3.5. Формирование отчетов
-   **FR-14:** ПО должно генерировать отчеты о полученных данных.
-   **FR-15:** Поддерживаемые форматы отчетов (выбираются ключами командной строки):
    -   HTML.
    -   PDF.
    -   Markdown.
    -   DOCX.
    -   XML.
-   **FR-16:** Форматы отчетов могут быть настроены с использованием шаблонов.
-   **FR-17:** Вид отчетов по умолчанию должен быть приемлемым и удобочитаемым.
-   **FR-18:** Допускается одновременное использование нескольких ключей для генерации отчетов в различных форматах.

### 3.6. Интерактивная карта
-   **FR-19:** ПО должно предоставлять возможность сохранения результатов в виде интерактивной карты (активируется отдельным ключом командной строки).
-   **FR-20:** Интерактивная карта должна отображать:
    -   Одним слоем (цветом) исходную зону интереса.
    -   Вторым слоем (другим цветом) полученные земельные участки.
-   **FR-21:** Участки на карте должны быть закрашены различными цветами в соответствии с категорией земель или видом разрешенного использования (выбор критерия раскраски должен предоставляться пользователю через селектор/параметр).
-   **FR-22:** При наведении курсора на участок на интерактивной карте должно всплывать сообщение с обязательной информацией (кадастровый номер, категория, вид использования).
-   **FR-23:** При клике по участку на интерактивной карте должно отображаться окно/панель с полным набором атрибутивной информации по данному участку.
-   **FR-24:** Необходимо решить вопрос оптимизации быстродействия и использования памяти при отображении интерактивной карты, учитывая возможность попадания в зону интереса десятков тысяч объектов.
-   **FR-25:** Функционал интерактивной карты должен проектироваться с перспективой его интеграции в состав собственного GUI приложения.

### 3.7. Расширяемость
-   **FR-26:** Необходимо предусмотреть возможность модульного расширения списков поддерживаемых входных форматов для зоны интереса.
-   **FR-27:** Необходимо предусмотреть возможность модульного расширения списков поддерживаемых выходных форматов для сохранения данных и отчетов.

### 3.8. Пользовательский опыт
-   **FR-28:** Все длительные процессы (скачивание данных, формирование отчетов и т.д.) должны сопровождаться отображением прогресс-бара в консоли.

## 4. Нефункциональные требования

### 4.1. Управление версиями
-   **NFR-1:** Исходный код проекта должен вестись в GIT-репозитории.
-   **NFR-2:** Адрес репозитория: `https://github.com/asm679/pkk_search`.
-   **NFR-3:** Каждое логически завершенное изменение кода (даже незначительное) должно оформляться коммитом с осмысленным комментарием. Комментарий к коммиту должен создаваться во временном файле, который удаляется после коммита. Перед коммитом должна выполняться команда `git add`.
-   **NFR-4:** После завершения крупного раздела плана или по запросу заказчика должен создаваться тег на коммит с аннотацией, расширяющей и дополняющей комментарий коммита.
-   **NFR-5:** Каждый минорный релиз должен сопровождаться тегом с подробным описанием нового функционала и изменений.

### 4.2. Качество кода и тестирование
-   **NFR-6:** Обеспечить покрытие кода тестами в осмысленном и достаточном объеме.
-   **NFR-7:** Настроить автоматическое тестирование при загрузке кода на GitHub.

### 4.3. Процесс разработки и документирование
-   **NFR-8:** Использовать лучшие практики и системы разработки (например, MVP, SOLID, Agile).
-   **NFR-9:** Подробнейшим образом документировать процесс разработки.
-   **NFR-10:** Вести Wiki-страницу проекта на GitHub.
-   **NFR-11:** Вести список изменений (Changelog).

### 4.4. Управление проектом (GitHub)
-   **NFR-12:** При обнаружении ошибок создавать Issues в репозитории GitHub.
-   **NFR-13:** При устранении ошибок отражать это закрытием соответствующего Issue с подробным пояснением проделанной работы и внесенных изменений.

## 5. Требования к пользовательскому интерфейсу

### 5.1. Интерфейс командной строки (CLI)
-   **UI-1:** Основной интерфейс взаимодействия для начальных версий ПО.
-   **UI-2:** Все функциональные возможности должны быть доступны через параметры командной строки.

### 5.2. Графический пользовательский интерфейс (GUI) - Перспектива
-   **UI-3:** Проектирование ПО должно учитывать возможность добавления GUI.
-   **UI-4:** GUI должен включать картографический движок для подготовки исходной информации (просмотр и редактирование зоны интереса) и отображения результатов, включая ранее описанную интерактивную карту.

## 6. Требования к данным

### 6.1. Источник данных
-   **DATA-1:** Единственным источником кадастровых данных является публичный ресурс PKK: `https://nspd.gov.ru/map?thematic=PKK&...`

### 6.2. Атрибуты данных
-   **DATA-2:** Минимальный набор атрибутов: кадастровый номер, категория земель, вид разрешенного использования, геометрия.
-   **DATA-3:** Желательный набор: все доступные атрибуты с PKK.

### 6.3. Форматы данных
-   **DATA-4:** Входной формат зоны интереса: KML (см. FR-4).
-   **DATA-5:** Форматы сохранения данных: GeoJSON, CSV, SQLite (см. FR-12).

## 7. Требования к документации проекта

### 7.1. Пользовательская документация
-   **DOC-1:** Руководство по установке и администрированию.
-   **DOC-2:** Руководство пользователя.
-   **DOC-3:** Документация должна быть доступна в форматах HTML, PDF и др.

### 7.2. Техническая документация
-   **DOC-4:** Руководство разработчика (описание архитектуры, модулей, API и т.д.).
-   **DOC-5:** Документация должна быть доступна в форматах HTML, PDF и др.

### 7.3. Документация репозитория
-   **DOC-6:** Оформить и поддерживать в актуальном состоянии GitHub-документацию (`Readme.md`, `CONTRIBUTING.md`, `CODE_OF_CONDUCT.md` и т.д.).
-   **DOC-7:** Документация должна быть оформлена в лучших традициях GitHub, использовать виджеты, изображения, скриншоты, скринкасты и прочее.
-   **DOC-8:** Во всех видах документации обязательно использовать иллюстративный материал. При невозможности непосредственного создания визуального контента, приводить подробную инструкцию по его созданию (ссылки на инструменты, скрипты, промпты для нейросетей и т.д.).

## 8. Предварительные исследования и подготовка

### 8.1. Исследование API/методов доступа к PKK
-   **PREP-1:** Прежде чем начинать основное проектирование и разработку, необходимо провести исследование и определить наилучшие из возможных способов получения информации из PKK.
-   **PREP-2:** Необходимо научиться выполнять запросы к PKK и получать данные без использования окна браузера (автоматизированно).
-   **PREP-3:** В качестве отправной точки для исследования можно использовать информацию из блога "QGIS кадастр": `https://vk.com/wall-224846721_54`.

### 8.2. Документирование решений
-   **PREP-4:** Все принятые технические решения, результаты исследований и другая важная информация должны быть документированы.
-   **PREP-5:** Для этих целей должен быть создан и поддерживаться файл `Директивы.md` (или аналогичный по смыслу).

## 9. Перспективы развития
-   Интеграция полноценного GUI с картографическим движком.
-   Расширение поддержки форматов входных и выходных данных.
-   Развитие функционала интерактивной карты.
-   Возможно, другие улучшения на основе обратной связи пользователей. 